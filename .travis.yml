sudo: required

language: java

jdk:
  - oraclejdk8

services:
  - docker

before_install:
  - docker build -t vertx-grpc .

install:
  - docker run --rm -v $(pwd):/workdir:Z -e CROSS_TRIPLE=${CROSS_TRIPLE} -it vertx-grpc ./build-protobuf.sh

script:
  - docker run --rm -v $(pwd):/workdir:Z -e CROSS_TRIPLE=${CROSS_TRIPLE} -it vertx-grpc make
  - mkdir -p out
  - ./x86_64-linux-gnu/protoc --plugin=protoc-gen-grpc-java=./x86_64-linux-gnu/protoc-gen-grpc-java.exe --grpc-java_out="out" --proto_path="test" "helloworld.proto"
  - ./x86_64-linux-gnu/protoc --plugin=protoc-gen-grpc-java=./x86_64-linux-gnu/protoc-gen-grpc-java.exe --grpc-java_out="out" --proto_path="test" "streaming.proto"

after_success:
  - ./deploy.sh

env:
  global:
    - secure: IjdignAqTlY9dvkCF4Z1tHyILrFBou+CoizRlS8L43B/vwTnZEEAgyfXG7zAkT1khje9c+TOqkEYWv+24VTgaX3mkgE1Am6nhqxYIG6ULdVVRJT5JAb8L//F3Sm+g/sS5guesUjT1wkEQ8ew6ZQ7/JoC/WKjqT7jklsX5g/6UsE=
    - secure: jGsaoOfcLzrHgsfIJBLTnhxO6C+4+qRYRMsLG1oJY4DfPZOqa78ShrL50kns15WDt9PkVq4ddPfINJrA5PmN3e0evupPRRDh1mcbvDjK9d4Mldyl5IJxRKL2lvPenC+EujOegVr9jp7Jv6QwI9mc4SJjzwA65uB96K5zvbEmUF0=
  - CROSS_TRIPLE=x86_64-linux-gnu
  - CROSS_TRIPLE=i686-w64-mingw32
  - CROSS_TRIPLE=x86_64-w64-mingw32
  - CROSS_TRIPLE=x86_64-apple-darwin
